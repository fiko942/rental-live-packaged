import{az as j,I as z,aw as A,r as w,_ as K,a3 as P,m as q}from"./index-Nr3L1iTT.js";import{n as s,S as B,p as n,G as D,D as $,q as m,F as T,w as N,z as C,s as r,H as u,a as h,y as k,o as E,E as F,ax as R,x as G}from"./index-Dgcy2TkH.js";import{T as J,a as L}from"./index-C4yX8D7f.js";import"./ContactFloating-CjrjB1BS.js";import"./useRefs-CriVDRZm.js";function y(f){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:2}).format(f)}const U=["1","2","3","4","5","6","7","8","9","0"];function S(f,b=1){const p=f.split("").filter(o=>U.includes(o)).join(""),v=parseInt(p);return isNaN(v)?b:v}const Q={key:0,class:"flex flex-col gap-1 mb-4"},W=["id"],X={class:"flex items-center w-full font-bold text-green-600"},Z={key:0,class:"flex items-center w-fit ml-auto mr-0 gap-1"},ee=["onClick"],te=["onClick"],ae={key:1,class:"flex items-center w-fit ml-auto mr-0 gap-1"},se=["onClick"],ne=r("div",{class:"text-sm text-gray-700"},"Nominal",-1),oe={key:1,class:"text-red-600 text-xs"},le={props:{open:{type:Boolean,required:!0}}},ie=Object.assign(le,{__name:"DepositDialog",props:["open"],emits:["close"],setup(f,{emit:b}){const p=b,v=f,o=s({amount:"Minimal Deposit: "+y(75e3)}),c=s(y(0)),x=s(!1),g=s(null),_=s([]),M=s("Mid-client--D1CkA4NJpEV_trY"),l=s(null);B(c,()=>{const t=S(c.value);o.value.amount=t<75e3?"Minimal Deposit: "+y(75e3):null});const d=()=>{const t="https://app.midtrans.com/snap/snap.js",a=document.createElement("script");a.src=t,a.setAttribute("data-client-key",M.value),a.async=!0,document.body.appendChild(a),l.value=a};B(v,()=>{v.open?(e(),d()):l.value&&document.body.removeChild(l.value)});const e=()=>{w("/balance/transactions","GET").then(t=>{console.log(t),_.value=t}).catch(t=>console.error(t.message||t))},I=()=>{x.value=!0,g.value=null,w("/balance/deposit","POST",{amount:S(c.value)}).then(t=>{e(),c.value=y(0)}).catch(t=>g.value=t.message?t.message:t).finally(()=>x.value=!1)},H=t=>{w("/balance/cancelTransaction","POST",{id:t}).then(()=>{e()}).catch(a=>console.error(a.message||a))},V=t=>{w("/balance/removeTransaction","POST",{id:t}).then(()=>{e()}).catch(a=>console.error(a.message||a))},Y=t=>{window.snap.pay(t)};return(t,a)=>(n(),D(u(A),{open:f.open,onCancel:a[1]||(a[1]=i=>p("close")),centered:"1",width:300,title:"Deposit",cancelText:"Batal",okText:"Deposit",okButtonProps:{disabled:Object.values(o.value).filter(i=>i!==null).length>0,loading:x.value},onOk:a[2]||(a[2]=i=>I())},{default:$(()=>[_.value.length>0?(n(),m("div",Q,[(n(!0),m(T,null,N(_.value,i=>(n(),m("div",{key:i.token,id:i.token,class:"flex items-center w-full hover:bg-gray-300 px-1"},[r("div",X,k(u(y)(i.amount)),1),i.status==="waiting_payment"?(n(),m("div",Z,[r("button",{class:"px-3 bg-red-500 text-white hover:bg-red-400",onClick:O=>H(i.id)},"Batal",8,ee),r("button",{class:"px-3 bg-green-600 text-white hover:bg-green-500",onClick:O=>Y(i.token)},"Bayar",8,te)])):(n(),m("div",ae,[r("button",{class:"px-3 bg-red-500 text-white hover:bg-red-400",onClick:O=>V(i.id)},"Hapus",8,se)]))],8,W))),128))])):C("",!0),r("div",null,[g.value?(n(),D(u(j),{key:0,message:g.value,type:"error",class:"mb-4"},null,8,["message"])):C("",!0),ne,h(u(z),{type:"text",value:c.value,onChange:a[0]||(a[0]=i=>c.value=u(y)(u(S)(i.target.value)))},null,8,["value"]),o.value.amount?(n(),m("div",oe,k(o.value.amount),1)):C("",!0)])]),_:1},8,["open","okButtonProps"]))}}),re={class:"flex items-center"},ue={class:"pl-4"},ce={key:0,class:"flex items-center w-fit mt-32 mx-auto"},de={key:1,class:"flex flex-col gap-1 mx-auto w-fit mt-4"},me={class:"bg-white rounded-lg shadow-3xl px-2 py-1",style:{width:"300px","max-width":"100%"}},ve={class:"font-bold text-sm text-gray-600"},pe={class:"text-xs text-gray-500"},xe={class:"flex items-center w-full mt-3"},fe={class:"text-xs text-gray-400"},be={__name:"index",setup(f){E(()=>{const l=new URL(document.location).searchParams;l.has("target")&&l.get("target")==="deposit"&&(x.value=!0)});const b=s([{name:"Semua",key:"all"},{name:"Saldo Keluar",key:"expense"},{name:"Saldo Masuk",key:"income"}]),p=s("all"),v=s(0);s(0),s(0);const o=s([]),c=s(!1),x=s(!1),g=s(!0),_=()=>{c.value=!0,w("/balance/transactionHistory","POST",{page:v.value,type:p.value}).then(l=>{o.value=[...l,...o.value].sort((d,e)=>e.at-d.at),g.value=l.length>0}).catch(l=>console.error(l.message||l)).finally(()=>c.value=!1)};B(p,()=>{o.value=[],v.value=0,_()}),E(_);const M=()=>{v.value++,_()};return(l,d)=>(n(),m(T,null,[h(ie,{open:x.value,onClose:d[0]||(d[0]=e=>x.value=!1)},null,8,["open"]),h(K,null,{default:$(()=>[r("div",re,[r("div",ue,[h(u(P),{class:"",onClick:d[1]||(d[1]=e=>x.value=!0)},{default:$(()=>[F("Deposit")]),_:1})]),h(u(J),{class:"w-fit mx-auto flex mt-2",activeKey:p.value,onChange:d[2]||(d[2]=e=>p.value=e),disabled:c.value},{default:$(()=>[(n(!0),m(T,null,N(b.value,e=>(n(),D(u(L),{key:e.key,id:e.key,tab:e.name},null,8,["id","tab"]))),128))]),_:1},8,["activeKey","disabled"])]),o.value.length<1?(n(),m("div",ce,[h(u(R),{description:"Tidak ada transaksi"})])):o.value.length>0?(n(),m("div",de,[(n(!0),m(T,null,N(o.value,e=>(n(),m("div",me,[r("div",ve,k(e.title),1),r("p",pe,k(e.description),1),r("div",xe,[r("div",fe,k(u(q)(e.at*1e3).tz("Asia/Jakarta").format("MMMM, D YYYY HH:mm")),1),r("div",{class:G(`flex w-fit ml-auto mr-0 text-xs ${e.amount<1?"text-red-500":"text-green-500"}`)},k(u(y)(e.amount)),3)])]))),256))])):C("",!0),g.value?(n(),D(u(P),{key:2,class:"flex mx-auto w-fit mt-4",disabled:c.value,loading:c.value,onClick:d[3]||(d[3]=e=>M())},{default:$(()=>[F("Muat lainnya")]),_:1},8,["disabled","loading"])):C("",!0)]),_:1})],64))}};export{be as default};
