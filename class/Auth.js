'use strict';const _0x5b2c49=_0x3c1b;function _0x3c1b(_0x29d23a,_0x2257fa){const _0x1422da=_0x1422();return _0x3c1b=function(_0x3c1bea,_0x4ef59f){_0x3c1bea=_0x3c1bea-0x10c;let _0x22d5df=_0x1422da[_0x3c1bea];return _0x22d5df;},_0x3c1b(_0x29d23a,_0x2257fa);}(function(_0x2a23cb,_0x94538){const _0x26e5c5=_0x3c1b,_0x4b40b4=_0x2a23cb();while(!![]){try{const _0x3f773d=parseInt(_0x26e5c5(0x11d))/0x1*(parseInt(_0x26e5c5(0x11b))/0x2)+-parseInt(_0x26e5c5(0x133))/0x3*(parseInt(_0x26e5c5(0x13f))/0x4)+-parseInt(_0x26e5c5(0x156))/0x5+-parseInt(_0x26e5c5(0x110))/0x6+-parseInt(_0x26e5c5(0x132))/0x7+parseInt(_0x26e5c5(0x12c))/0x8+-parseInt(_0x26e5c5(0x124))/0x9*(-parseInt(_0x26e5c5(0x13e))/0xa);if(_0x3f773d===_0x94538)break;else _0x4b40b4['push'](_0x4b40b4['shift']());}catch(_0x5673ac){_0x4b40b4['push'](_0x4b40b4['shift']());}}}(_0x1422,0x39f5f));function _0x1422(){const _0x31b00f=['forgotPassword','profile','Asia/Jakarta','POST','update','3428946nTHAXV','INVALID_TOKEN','/auth/g-callback','Akun\x20anda\x20dinonaktifkan','toLowerCase','destroy','user','session','3731632zrxhkT','topup','@gmail.com','moment-timezone','Akun\x20anda\x20belum\x20teraktivasi','encryption','611667yXzTTo','45909WputgD','emailVerificationCode','setLimit','stringify','code','emailResetPasswordToken','Email\x20sudah\x20terdaftar','balance','application/x-www-form-urlencoded','password','__awaiter','20EzsBNr','112BRvRMv','put','emailVerification','unix','Akunmu\x20belum\x20terverifikasi,\x20silahkan\x20verifikasi\x20terlebih\x20dahulu','encrypt','default','decrypt','banned','generate','access_token','login','create','join','Akun\x20anda\x20tidak\x20bisa\x20login\x20menggunakan\x20metode\x20ini','json','https://accounts.google.com/o/oauth2/auth?','&h=','exists','getResetPassTokenDetail','/reset-password?c=','detail','Kode\x20tidak\x20valid','547350gGNRWT','Akun\x20tidak\x20ditemukan','Password\x20terlalu\x20pendek','findOne','FRONTEND_URL','sent','Akunmu\x20dinonaktifkan','Bonus\x20pendaftaran,\x20karena\x20terdeteksi\x20bukan\x20spam\x20ataupun\x20bot,\x20silahkan\x20gunakan\x20saldo\x20ini\x20untuk\x20melakukan\x20trial\x20/\x20demo\x20dengan\x20sebaik\x20baiknya','trim','storage','node-fetch','database','GOOGLE_OAUTH_CLIENTID','register','EXPIRED_TOKEN','defineProperty','sentMailVerification','Kami\x20telah\x20menerima\x20permintaan\x20ubah\x20password\x20Anda.\x20Untuk\x20melanjutkan\x20klik\x20link\x20dibawah\x20ini.\x0a\x0aKetentuan:\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20â€£\x20Link\x20akan\x20expired\x20setelah\x2030\x20menit\x20sejak\x20pesan\x20dikirim\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0aLink:\x20','https://www.googleapis.com/oauth2/v1/userinfo?alt=json','length','https://oauth2.googleapis.com/token','email','uuid','expired','__esModule','Bonus\x20pendaftaran','2811198KdDlPv','google','googleCallback','Ubah\x20Password','apply','BACKEND_URL','Kode\x20telah\x20kadaluarsa','split','includes','env','findIndex','205666YsnWUY','throw','1oDZsBf','done'];_0x1422=function(){return _0x31b00f;};return _0x1422();}var __awaiter=this&&this[_0x5b2c49(0x13d)]||function(_0x47467f,_0xe8c80a,_0x432bc5,_0x45b0c0){function _0x2da9bf(_0x1d84cf){return _0x1d84cf instanceof _0x432bc5?_0x1d84cf:new _0x432bc5(function(_0x2583db){_0x2583db(_0x1d84cf);});}return new(_0x432bc5||(_0x432bc5=Promise))(function(_0x2ba9fe,_0x411ad9){const _0x259cd0=_0x3c1b;function _0x35d534(_0x39c082){try{_0x2eca49(_0x45b0c0['next'](_0x39c082));}catch(_0x37c9b4){_0x411ad9(_0x37c9b4);}}function _0x585bdb(_0x1865c1){const _0x37afae=_0x3c1b;try{_0x2eca49(_0x45b0c0[_0x37afae(0x11c)](_0x1865c1));}catch(_0x2d1e71){_0x411ad9(_0x2d1e71);}}function _0x2eca49(_0x1c3a34){const _0x2767a9=_0x3c1b;_0x1c3a34[_0x2767a9(0x11e)]?_0x2ba9fe(_0x1c3a34['value']):_0x2da9bf(_0x1c3a34['value'])['then'](_0x35d534,_0x585bdb);}_0x2eca49((_0x45b0c0=_0x45b0c0[_0x259cd0(0x114)](_0x47467f,_0xe8c80a||[]))['next']());});},__importDefault=this&&this['__importDefault']||function(_0x5c8f56){const _0x5e51e1=_0x5b2c49;return _0x5c8f56&&_0x5c8f56[_0x5e51e1(0x10e)]?_0x5c8f56:{'default':_0x5c8f56};};Object[_0x5b2c49(0x165)](exports,_0x5b2c49(0x10e),{'value':!![]});const moment_timezone_1=__importDefault(require(_0x5b2c49(0x12f))),uuid_1=require(_0x5b2c49(0x10c)),query_string_1=__importDefault(require('query-string')),node_fetch_1=__importDefault(require(_0x5b2c49(0x160)));class Auth{constructor({database:_0x1dbb1f,user:_0x210794,encryption:_0x5d2024,session:_0x263780,email:_0x5a1a3c,storage:_0xb647de,balance:_0x1a5004}){const _0x37d1bb=_0x5b2c49;this[_0x37d1bb(0x161)]=_0x1dbb1f,this[_0x37d1bb(0x12a)]=_0x210794,this[_0x37d1bb(0x12b)]=_0x263780,this[_0x37d1bb(0x15f)]=_0xb647de,this[_0x37d1bb(0x16b)]=_0x5a1a3c,this[_0x37d1bb(0x131)]=_0x5d2024,this[_0x37d1bb(0x13a)]=_0x1a5004;}[_0x5b2c49(0x112)](_0x4a2b08){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x37df06=_0x3c1b,_0x54f00d={'code':_0x4a2b08,'client_id':process['env']['GOOGLE_OAUTH_CLIENTID'],'client_secret':process[_0x37df06(0x119)]['GOOGLE_OAUTH_SECRET'],'redirect_uri':process[_0x37df06(0x119)]['BACKEND_URL']+_0x37df06(0x126),'grant_type':'authorization_code'},_0xeb2436=yield(0x0,node_fetch_1[_0x37df06(0x145)])(_0x37df06(0x16a),{'method':_0x37df06(0x122),'headers':{'Content-Type':_0x37df06(0x13b)},'body':query_string_1[_0x37df06(0x145)][_0x37df06(0x136)](_0x54f00d)}),_0x3da6d9=yield _0xeb2436[_0x37df06(0x14e)](),_0x7006bc=_0x3da6d9[_0x37df06(0x149)],_0x3a10f7=yield(0x0,node_fetch_1[_0x37df06(0x145)])(_0x37df06(0x168),{'headers':{'Authorization':'Bearer\x20'+_0x7006bc}}),_0x1b40f3=yield _0x3a10f7[_0x37df06(0x14e)](),{email:_0x203e71,name:_0x11a13b}=_0x1b40f3,_0x4f0768=yield this[_0x37df06(0x12a)][_0x37df06(0x151)](_0x203e71,_0x37df06(0x16b));if(!_0x4f0768){const _0x429638=(0x0,moment_timezone_1[_0x37df06(0x145)])()['tz'](_0x37df06(0x121));yield this[_0x37df06(0x161)]['user'][_0x37df06(0x14b)]({'name':_0x11a13b,'email':_0x203e71,'emailVerified':!![],'banned':![],'created':_0x429638['unix'](),'password':null,'alias':null,'ip':null,'balance':0x0,'isDeveloper':![]});const _0x4f0458=yield this[_0x37df06(0x12a)]['detail'](_0x203e71,'email');_0x203e71['includes'](_0x37df06(0x12e))&&(yield this[_0x37df06(0x13a)][_0x37df06(0x140)]({'email':_0x203e71,'id':parseInt(_0x4f0458['id']),'amount':0x3a98,'title':'Bonus\x20saldo','description':'Bonus\x20saldo,\x20silahkan\x20dimanfaatkan\x20sebaik\x20baiknya\x20untuk\x20melakukan\x20trial','type':_0x37df06(0x12d)}),yield this[_0x37df06(0x15f)][_0x37df06(0x135)](parseInt(_0x4f0458['id']),0x96));}const _0x37e25c=yield this[_0x37df06(0x12b)][_0x37df06(0x148)](_0x203e71);return _0x37e25c;});}[_0x5b2c49(0x111)](_0x2881d9){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1fae08=_0x3c1b,_0x112cc2=[_0x1fae08(0x120),_0x1fae08(0x16b)],_0x5d412c=query_string_1['default']['stringify']({'client_id':process[_0x1fae08(0x119)][_0x1fae08(0x162)],'redirect_uri':process[_0x1fae08(0x119)][_0x1fae08(0x115)]+'/auth/g-callback','response_type':_0x1fae08(0x137),'scope':_0x112cc2[_0x1fae08(0x14c)]('\x20')}),_0x24a1c0=_0x1fae08(0x14f)+_0x5d412c;_0x2881d9['redirect'](_0x24a1c0);});}[_0x5b2c49(0x14a)](_0x26da18,_0x41cb6e){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xd08641=_0x3c1b;_0x26da18=_0x26da18[_0xd08641(0x15e)]()[_0xd08641(0x128)]();const _0x200c5f=yield this[_0xd08641(0x12a)][_0xd08641(0x154)](_0x26da18,_0xd08641(0x16b));if(!_0x200c5f[_0xd08641(0x13c)])throw new Error(_0xd08641(0x14d));const _0xc2acbb=this[_0xd08641(0x131)][_0xd08641(0x146)](_0x200c5f[_0xd08641(0x13c)]);if(_0xc2acbb!==_0x41cb6e)throw new Error('Kata\x20sandi\x20yang\x20anda\x20masukkan\x20salah');if(_0x200c5f[_0xd08641(0x147)])throw new Error(_0xd08641(0x15c));if(!_0x200c5f['emailVerified'])throw new Error(_0xd08641(0x143));const _0x256649=yield this[_0xd08641(0x12b)][_0xd08641(0x148)](_0x200c5f[_0xd08641(0x16b)]);return _0x256649;});}[_0x5b2c49(0x163)](_0x185e6e,_0x32da66){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x34dc75=_0x3c1b;_0x185e6e=_0x185e6e[_0x34dc75(0x15e)]()['toLowerCase']();if(_0x32da66['trim']()[_0x34dc75(0x169)]<0x3)throw new Error('Password\x20terlalu\x20pendek');const _0x11e25a=yield this['user']['exists'](_0x185e6e,_0x34dc75(0x16b));if(_0x11e25a)throw new Error(_0x34dc75(0x139));_0x32da66=_0x32da66[_0x34dc75(0x15e)]();const _0x34bba1=(0x0,moment_timezone_1[_0x34dc75(0x145)])()['tz']('Asia/Jakarta')['unix'](),_0x71e33f=yield this[_0x34dc75(0x161)][_0x34dc75(0x12a)][_0x34dc75(0x14b)]({'email':_0x185e6e,'password':this[_0x34dc75(0x131)][_0x34dc75(0x144)](_0x32da66),'name':_0x185e6e[_0x34dc75(0x117)]('@')[0x0],'emailVerified':![],'banned':![],'created':_0x34bba1,'alias':null,'ip':null,'balance':0x0});yield this[_0x34dc75(0x12a)][_0x34dc75(0x166)](_0x185e6e),yield this['storage'][_0x34dc75(0x135)](_0x71e33f['id'],0x0);});}[_0x5b2c49(0x141)](_0x3000c7,_0x30b14a){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x34316e=_0x3c1b,_0x400aa0=yield this[_0x34316e(0x161)][_0x34316e(0x134)][_0x34316e(0x159)]({'where':{'created':_0x3000c7,'hash':_0x30b14a}}),_0x188bb2=(0x0,moment_timezone_1['default'])()['tz'](_0x34316e(0x121))[_0x34316e(0x142)]();if(!_0x400aa0)throw new Error(_0x34316e(0x155));if(_0x400aa0[_0x34316e(0x10d)]<_0x188bb2)throw new Error(_0x34316e(0x116));yield this[_0x34316e(0x161)][_0x34316e(0x12a)]['update']({'emailVerified':!![]},{'where':{'email':_0x400aa0[_0x34316e(0x16b)]}}),yield this['database']['emailVerificationCode']['destroy']({'where':{'email':_0x400aa0[_0x34316e(0x16b)]}});const _0x5ee11f=yield this[_0x34316e(0x12a)]['detail'](_0x400aa0['email'],'email'),_0x1891be=[_0x34316e(0x12e)],_0x59f7da=_0x1891be[_0x34316e(0x11a)](_0x4c4696=>_0x5ee11f[_0x34316e(0x16b)][_0x34316e(0x118)](_0x4c4696));_0x59f7da>=0x0&&(yield this[_0x34316e(0x15f)][_0x34316e(0x135)](parseInt(_0x5ee11f['id']),0x96),yield this[_0x34316e(0x13a)][_0x34316e(0x140)]({'email':_0x5ee11f['email'],'id':parseInt(_0x5ee11f['id']),'amount':0x3a98,'type':_0x34316e(0x12d),'title':_0x34316e(0x10f),'description':_0x34316e(0x15d)}));});}[_0x5b2c49(0x11f)](_0x3ab901){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x189af5=_0x3c1b;_0x3ab901=_0x3ab901[_0x189af5(0x128)]()[_0x189af5(0x15e)]();const _0x201f09=yield this[_0x189af5(0x12a)][_0x189af5(0x154)](_0x3ab901,'email');if(!_0x201f09)throw new Error(_0x189af5(0x157));if(_0x201f09[_0x189af5(0x147)])throw new Error(_0x189af5(0x127));if(!_0x201f09['emailVerified'])throw new Error(_0x189af5(0x130));const _0xe6388d=(0x0,moment_timezone_1[_0x189af5(0x145)])()['tz'](_0x189af5(0x121))['unix'](),_0x5b2dcf=(0x0,uuid_1['v4'])();yield this[_0x189af5(0x161)][_0x189af5(0x138)][_0x189af5(0x14b)]({'created':_0xe6388d,'expired':_0xe6388d+0x708,'email':_0x3ab901,'hash':_0x5b2dcf});const _0x46712c=process[_0x189af5(0x119)][_0x189af5(0x15a)]+_0x189af5(0x153)+_0xe6388d+_0x189af5(0x150)+_0x5b2dcf,_0x52b7b9=_0x189af5(0x167)+_0x46712c;yield this[_0x189af5(0x16b)][_0x189af5(0x15b)](_0x3ab901,_0x189af5(0x113),_0x52b7b9);});}[_0x5b2c49(0x152)](_0x7a7696,_0x2c67b8){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x24b313=_0x3c1b,_0x43c3e8=yield this[_0x24b313(0x161)][_0x24b313(0x138)]['findOne']({'where':{'created':_0x7a7696,'hash':_0x2c67b8}});if(!_0x43c3e8)throw new Error('INVALID_TOKEN');const _0x509195=(0x0,moment_timezone_1[_0x24b313(0x145)])()['tz'](_0x24b313(0x121))[_0x24b313(0x142)](),_0x4b067f=_0x43c3e8[_0x24b313(0x10d)];if(_0x509195>_0x4b067f)throw new Error(_0x24b313(0x164));return{'email':_0x43c3e8[_0x24b313(0x16b)]};});}['resetPassword'](_0x29fc46){return __awaiter(this,arguments,void 0x0,function*({password:_0x5841f4,created:_0x37dad0,hash:_0x2302bb}){const _0x309987=_0x3c1b,_0xf09a68=atob(_0x5841f4)[_0x309987(0x15e)]();if(_0xf09a68['length']<0x1)throw new Error(_0x309987(0x158));const _0x9977d8=(0x0,moment_timezone_1[_0x309987(0x145)])()['tz'](_0x309987(0x121))[_0x309987(0x142)](),_0x4d35ec=yield this[_0x309987(0x161)][_0x309987(0x138)][_0x309987(0x159)]({'where':{'hash':_0x2302bb,'created':_0x37dad0}});if(!_0x4d35ec)throw new Error(_0x309987(0x125));if(_0x9977d8>_0x4d35ec[_0x309987(0x10d)])throw new Error(_0x309987(0x164));const _0x5a5a36=yield this[_0x309987(0x12a)][_0x309987(0x154)](_0x4d35ec['email'],_0x309987(0x16b));yield this[_0x309987(0x161)][_0x309987(0x12a)][_0x309987(0x123)]({'password':this[_0x309987(0x131)][_0x309987(0x144)](_0xf09a68)},{'where':{'id':_0x5a5a36['id']}}),yield this['database']['session']['destroy']({'where':{'userEmail':_0x5a5a36[_0x309987(0x16b)]}}),yield this[_0x309987(0x161)][_0x309987(0x138)][_0x309987(0x129)]({'where':{'created':_0x37dad0,'hash':_0x2302bb}});});}}exports['default']=Auth;